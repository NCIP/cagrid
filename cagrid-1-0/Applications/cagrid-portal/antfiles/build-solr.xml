<?xml version="1.0"?>

<project name="cagrid-portal-solr">

    <property name="tools.dir" value="${basedir}/tools"/>
    <property name="solr.dir" value="${tools.dir}/solr"/>
    <property name="solr.home.src.dir" value="${solr.dir}/home"/>
    <property name="solr.webapp.dir" value="${solr.dir}/webapp"/>

    <property name="liferay.jboss.home" value="${liferay.jboss.dir}/${jboss.server.name}"/>
    <property name="solr.home.jboss.deploy.dest.dir"
              value="${liferay.jboss.home}/server/${liferay.jboss.server.name}/solr"/>
    <property name="webapp.jboss.deploy.destdir"
              value="${liferay.jboss.home}/server/${liferay.jboss.server.name}/deploy"/>

    <filterset id="solr.home.filterset">
        <filter token="SOLR_HOME" value="${solr.home.jboss.deploy.dest.dir}"/>
    </filterset>

    <target name="solr:copy-solr-home" depends="prepare">
        <!--deploy solr.home-->
        <copy todir="${solr.home.jboss.deploy.dest.dir}">
            <fileset dir="${solr.home.src.dir}"/>
        </copy>

        <copy todir="${solr.home.jboss.deploy.dest.dir}" overwrite="true" filtering="true">
            <fileset dir="${solr.home.src.dir}">
                <include name="**/solrconfig.xml">
                </include>
            </fileset>
            <filterset refid="solr.home.filterset"/>
        </copy>

    </target>

    <target name="solr:copy-solr-webapp" depends="prepare">

        <copy todir="${webapp.jboss.deploy.destdir}">
            <fileset dir="${solr.webapp.dir}"/>
        </copy>

        <copy todir="${webapp.jboss.deploy.destdir}" overwrite="true" filtering="true">
            <fileset dir="${solr.webapp.dir}">
                <include name="**/web.xml">
                </include>
            </fileset>
            <filterset refid="solr.home.filterset"/>
        </copy>

    </target>

    <target name="solr:deploy" depends="solr:copy-solr-home,solr:copy-solr-webapp">
    </target>

</project>